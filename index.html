<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>JSON-LD Visualization with D3.js</title>
	<script src="https://d3js.org/d3.v7.min.js"></script>
	<style>
		html,
		body,
		svg {
			width: 100%;
			height: 100%;
			margin: 0;
			padding: 0;
			overflow: hidden;
		}

		.node circle {
			stroke: #333;
			stroke-width: 1.5px;
			cursor: pointer;
			transition: r 0.2s ease-in-out;
		}

		.node text {
			font-size: 12px;
			pointer-events: none;
			transition: font-size 0.2s ease-in-out;
		}

		.link {
			fill: none;
			stroke: #cccccc;
			stroke-width: 1.5px;
		}

		.legend {
			position: absolute;
			top: 10px;
			left: 10px;
			background: rgba(255, 255, 255, 0.8);
			padding: 10px;
			border-radius: 4px;
			font-family: Arial, sans-serif;
			font-size: 14px;
		}

		.legend div {
			margin-bottom: 5px;
			cursor: pointer;
			padding: 3px;
			border-radius: 3px;
		}

		.legend div:hover {
			background: rgba(0, 0, 0, 0.1);
		}

		.legend div.active {
			background: rgba(0, 0, 0, 0.2);
			font-weight: bold;
			box-shadow: 0 0 2px rgba(0, 0, 0, 0.2);
		}

		.legend-color {
			display: inline-block;
			width: 12px;
			height: 12px;
			margin-right: 5px;
			vertical-align: middle;
		}

		.link-label {
			font-size: 10px;
			fill: white;
			pointer-events: none;
			background: black;
			padding: 2px 6px;
			border-radius: 12px;
		}

		.controls {
			position: absolute;
			bottom: 10px;
			left: 10px;
			background: rgba(255, 255, 255, 0.8);
			padding: 10px;
			border-radius: 4px;
			font-family: Arial, sans-serif;
		}

		.zoom-button {
			display: block;
			width: 30px;
			height: 30px;
			margin: 5px;
			border: 1px solid #333;
			border-radius: 4px;
			background: white;
			cursor: pointer;
			font-size: 18px;
			line-height: 30px;
			text-align: center;
		}

		.zoom-button:hover {
			background: #eee;
		}

		.node.dimmed circle {
			opacity: 0.2;
		}
		
		.node.dimmed text {
			opacity: 0.2;
		}
		
		.link.dimmed {
			opacity: 0.1;
		}
		
		.link.dimmed text, .link.dimmed rect {
			opacity: 0.1;
		}

		.node:hover circle {
			r: 20;
			stroke-width: 2px;
		}

		.node:hover text {
			font-size: 16px;
			font-weight: bold;
		}
	</style>
</head>

<body>
	<div class="legend">
		<div><span class="legend-color" style="background: #69b3a2;"></span>Organization</div>
		<div><span class="legend-color" style="background: #ffcc00;"></span>Department</div>
		<div><span class="legend-color" style="background: #ff6600;"></span>Role</div>
		<div><span class="legend-color" style="background: #0066cc;"></span>Process</div>
		<div><span class="legend-color" style="background: #cc0066;"></span>Task</div>
		<div><span class="legend-color" style="background: #9900cc;"></span>Integration</div>
		<div><span class="legend-color" style="background: #00cc99;"></span>DataSource</div>
		<div><span class="legend-color" style="background: #ff3333;"></span>AIComponent</div>
		<div><span class="legend-color" style="background: #3333ff;"></span>Analytics</div>
		<div><span class="legend-color" style="background: #ff99cc;"></span>SoftwareTool</div>
	</div>
	<div class="controls">
		<button class="zoom-button" id="zoom-in">+</button>
		<button class="zoom-button" id="zoom-out">-</button>
	</div>
	<script>
		// Sample JSON-LD data
					const jsonld = {
						"@context": {
							"@vocab": "https://schema.org/",
							"version": "schema:version",
							"versionDate": "schema:dateModified",
							"previousVersion": "schema:predecessorOf",
							"hasDepartment": {
								"@id": "schema:Department",
								"@container": "@set"
							},
							"hasRole": {
								"@id": "schema:Role",
								"@container": "@set"
							},
							"hasEmployee": {
								"@id": "schema:Employee",
								"@container": "@set"
							},
							"hasProcess": {
								"@id": "schema:Process",
								"@container": "@set"
							},
							"hasTask": {
								"@id": "schema:Task",
								"@container": "@set"
							},
							"hasIntegration": {
								"@id": "schema:Integration",
								"@container": "@set"
							},
							"hasDataSource": {
								"@id": "schema:DataSource",
								"@container": "@set"
							},
							"hasAIComponent": {
								"@id": "schema:AIComponent",
								"@container": "@set"
							},
							"hasAnalytics": {
								"@id": "schema:Analytics",
								"@container": "@set"
							},
							"hasSoftwareTool": {
								"@id": "schema:SoftwareTool",
								"@container": "@set"
							}
						},
						"@type": "Organization",
						"@id": "https://example.com/organization/v1",
						"version": "1.0.0",
						"versionDate": "2024-03-20",
						"previousVersion": "https://example.com/organization/v0.9",
						"name": "Example Business Inc.",
						"url": "https://example.com",
						"description": "A business demonstrating an ontology for organizational structure, roles, workflows, integrations, data sources, AI/ML, analytics, and tools.",
						"address": {
							"@type": "PostalAddress",
							"streetAddress": "123 Main St",
							"addressLocality": "Anytown",
							"addressRegion": "CA",
							"postalCode": "12345",
							"addressCountry": "US"
						},
						"contactPoint": {
							"@type": "ContactPoint",
							"telephone": "+1-123-555-0123",
							"contactType": "Customer Service"
						},
						"hasDepartment": [
							{
								"@type": "Department",
								"@id": "https://example.com/department/sales/v2",
								"version": "2.0.0",
								"versionDate": "2024-03-15",
								"previousVersion": "https://example.com/department/sales/v1",
								"name": "Sales",
								"description": "Handles sales operations and customer outreach.",
								"hasRole": [
									{
										"@type": "Role",
										"name": "Sales Manager",
										"responsibilities": "Oversees sales strategy and manages the sales team."
									},
									{
										"@type": "Role",
										"name": "Sales Associate",
										"responsibilities": "Engages with customers and supports sales activities."
									}
								],
								"hasProcess": [
									{
										"@type": "Process",
										"name": "Lead Conversion Process",
										"description": "A process for converting leads into customers, involving sales and marketing.",
										"workflow": [
											{
												"@type": "Task",
												"name": "Initial Outreach",
												"description": "Contact the lead within 24 hours of their inquiry.",
												"responsibleRole": {
													"@type": "Role",
													"name": "Sales Associate"
												},
												"taskStatus": "https://schema.org/ActiveActionStatus"
											}
										]
									}
								]
							},
							{
								"@type": "Department",
								"@id": "https://example.com/department/marketing/v1",
								"version": "1.0.0",
								"versionDate": "2024-03-20",
								"name": "Marketing",
								"description": "Handles marketing activities and customer engagement.",
								"hasRole": [
									{
										"@type": "Role",
										"name": "Marketing Manager",
										"responsibilities": "Develops marketing strategies and oversees the marketing team."
									}
								]
							}
						],
						"hasProcess": [
							{
								"@type": "Process",
								"@id": "https://example.com/process/customer-support/v3",
								"version": "3.1.2",
								"versionDate": "2024-03-18",
								"previousVersion": "https://example.com/process/customer-support/v2",
								"name": "Customer Support Process",
								"description": "A process to manage customer inquiries and issues.",
								"workflow": [
									{
										"@type": "Task",
										"@id": "https://example.com/task/log-inquiry/v1",
										"version": "1.0.0",
										"versionDate": "2024-03-20",
										"name": "Log Customer Inquiry",
										"responsibleRole": {
											"@type": "Role",
											"name": "Customer Support Agent"
										}
									}
								],
								"hasIntegration": [
									{
										"@type": "Integration",
										"@id": "https://example.com/integration/crm/v2",
										"version": "2.1.0",
										"versionDate": "2024-03-10",
										"previousVersion": "https://example.com/integration/crm/v1",
										"name": "CRM System",
										"description": "Manages customer information and interactions.",
										"integratesWith": {
											"@type": "SoftwareTool",
											"name": "Salesforce"
										}
									}
								],
								"hasDataSource": [
									{
										"@type": "DataSource",
										"name": "Customer Database",
										"description": "Stores customer data for support and sales use."
									}
								]
							}
						],
						"hasAIComponent": [
							{
								"@type": "AIComponent",
								"@id": "https://example.com/ai/sentiment-analysis/v1",
								"version": "1.2.3",
								"versionDate": "2024-03-19",
								"modelVersion": "gpt-4-0125-preview",
								"name": "Customer Sentiment Analysis",
								"description": "Analyzes customer communications to detect sentiment and flag issues.",
								"relatedProcess": {
									"@type": "Process",
									"name": "Customer Support Process"
								},
								"usesDataSource": {
									"@type": "DataSource",
									"name": "Customer Database"
								},
								"softwareTool": {
									"@type": "SoftwareTool",
									"name": "OpenAI API"
								}
							}
						],
						"hasAnalytics": [
							{
								"@type": "Analytics",
								"name": "Sales Performance Analytics",
								"description": "Analyzes sales team performance metrics and KPIs.",
								"relatedDepartment": {
									"@type": "Department",
									"name": "Sales"
								},
								"dataSource": [
									{
										"@type": "DataSource",
										"name": "Sales Database"
									}
								]
							}
						],
						"hasSoftwareTool": [
							{
								"@type": "SoftwareTool",
								"@id": "https://example.com/tool/salesforce/v2024.1",
								"version": "2024.1.0",
								"versionDate": "2024-03-01",
								"previousVersion": "https://example.com/tool/salesforce/v2023.4",
								"name": "Salesforce",
								"apiVersion": "v58.0",
								"description": "CRM tool used for managing customer relationships and sales data.",
								"relatedIntegration": {
									"@type": "Integration",
									"name": "CRM System"
								}
							},
							{
								"@type": "SoftwareTool",
								"name": "HubSpot",
								"description": "Marketing automation tool used by the Marketing department.",
								"relatedDepartment": {
									"@type": "Department",
									"name": "Marketing"
								}
							}
						]
					};

		// Convert JSON-LD to a graph structure
		const nodes = [];
		const links = [];
		const nodeMap = new Map();

		function parseJsonLd(data, parent = null) {
			const nodeId = data.name || data['@type'] || "Unknown";
			let currentNode;

			if (nodeMap.has(nodeId)) {
				currentNode = nodeMap.get(nodeId);
			} else {
				currentNode = { id: nodeId, type: data['@type'] || "Unknown" };
				nodes.push(currentNode);
				nodeMap.set(nodeId, currentNode);
			}

			if (parent) {
				links.push({ 
					source: parent.id, 
					target: currentNode.id,
					relationship: getRelationshipType(data['@type'])
				});
			}

			if (data.hasDepartment) {
				data.hasDepartment.forEach(department => parseJsonLd(department, currentNode));
			}

			if (data.hasRole) {
				data.hasRole.forEach(role => parseJsonLd(role, currentNode));
			}

			if (data.hasProcess) {
				data.hasProcess.forEach(process => parseJsonLd(process, currentNode));
			}

			if (data.workflow) {
				data.workflow.forEach(task => parseJsonLd(task, currentNode));
			}

			if (data.hasIntegration) {
				data.hasIntegration.forEach(integration => parseJsonLd(integration, currentNode));
			}

			if (data.hasDataSource) {
				data.hasDataSource.forEach(dataSource => parseJsonLd(dataSource, currentNode));
			}

			if (data.hasAIComponent) {
				data.hasAIComponent.forEach(aiComponent => parseJsonLd(aiComponent, currentNode));
			}

			if (data.hasAnalytics) {
				data.hasAnalytics.forEach(analytics => parseJsonLd(analytics, currentNode));
			}

			if (data.hasSoftwareTool) {
				data.hasSoftwareTool.forEach(softwareTool => parseJsonLd(softwareTool, currentNode));
			}

			if (data.relatedProcess) {
				parseJsonLd(data.relatedProcess, currentNode);
			}

			if (data.usesDataSource) {
				parseJsonLd(data.usesDataSource, currentNode);
			}

			if (data.softwareTool) {
				parseJsonLd(data.softwareTool, currentNode);
			}

			if (data.relatedDepartment) {
				parseJsonLd(data.relatedDepartment, currentNode);
			}

			if (data.dataSource) {
				data.dataSource.forEach(source => parseJsonLd(source, currentNode));
			}

			if (data.relatedIntegration) {
				parseJsonLd(data.relatedIntegration, currentNode);
			}

			if (data.relatedRole) {
				parseJsonLd(data.relatedRole, currentNode);
			}

			if (data.responsibleRole) {
				parseJsonLd(data.responsibleRole, currentNode);
			}
		}

		parseJsonLd(jsonld);

		// D3 force-directed graph
		const width = window.innerWidth;
		const height = window.innerHeight;

		const svg = d3.select("body").append("svg")
			.attr("width", width)
			.attr("height", height);

		const colorScale = d3.scaleOrdinal()
			.domain(["Organization", "Department", "Role", "Process", "Task", "Integration", "DataSource", "AIComponent", "Analytics", "SoftwareTool"])
			.range(["#69b3a2", "#ffcc00", "#ff6600", "#0066cc", "#cc0066", "#9900cc", "#00cc99", "#ff3333", "#3333ff", "#ff99cc"]);

		const simulation = d3.forceSimulation(nodes)
			.force("link", d3.forceLink(links).id(d => d.id).distance(200))
			.force("charge", d3.forceManyBody().strength(-800))
			.force("center", d3.forceCenter(width / 2, height / 2))
			.force("collision", d3.forceCollide().radius(50));

		// Create a single container for all graph elements
		const container = svg.append("g").attr("class", "zoom-container");

		// Move link and node selections into the container
		const link = container.append("g")
			.selectAll("g")
			.data(links)
			.enter()
			.append("g");

		link.append("line")
			.attr("class", "link");

		link.append("rect")
			.attr("rx", 10)
			.attr("ry", 10)
			.attr("class", "link-label-bg")
			.attr("fill", "black")
			.attr("opacity", 0.8);

		link.append("text")
			.attr("class", "link-label")
			.attr("text-anchor", "middle")
			.attr("dy", "0.35em")
			.attr("fill", "white")
			.text(d => d.relationship);

		const node = container.append("g")
			.selectAll("g")
			.data(nodes)
			.enter().append("g")
			.attr("class", "node")
			.call(d3.drag()
				.on("start", dragstarted)
				.on("drag", dragged)
				.on("end", dragended));

		node.append("circle")
			.attr("r", 10)
			.attr("fill", d => colorScale(d.type))
			.on("mouseover", function(event, d) {
				const circle = d3.select(this);
				const currentZoom = d3.zoomTransform(svg.node()).k;
				const baseRadius = 10;
				const hoverRadius = 20;
				
				circle.transition()
					.duration(200)
					.attr("r", hoverRadius / currentZoom);
			})
			.on("mouseout", function() {
				const circle = d3.select(this);
				circle.transition()
					.duration(200)
					.attr("r", 10);
			});

		node.append("text")
			.attr("x", 12)
			.attr("dy", ".35em")
			.text(d => d.id)
			.each(function() {
				const text = d3.select(this);
				const parentNode = d3.select(this.parentNode);
				
				parentNode.on("mouseover", function() {
					const currentZoom = d3.zoomTransform(svg.node()).k;
					const baseFontSize = 12;
					const hoverFontSize = 16;
					const baseMargin = 12;
					const hoverMargin = 24;
					
					text.transition()
						.duration(200)
						.style("font-size", `${hoverFontSize / currentZoom}px`)
						.attr("x", hoverMargin / currentZoom);
				})
				.on("mouseout", function() {
					const currentZoom = d3.zoomTransform(svg.node()).k;
					const baseMargin = 12;
					
					text.transition()
						.duration(200)
						.style("font-size", "12px")
						.attr("x", baseMargin / currentZoom);
				});
			});

		// Update the zoom behavior
		const zoom = d3.zoom()
			.scaleExtent([0.1, 4])
			.on("zoom", (event) => {
				container.attr("transform", event.transform);
				
				// Update text position based on zoom
				node.select("text")
					.attr("x", 12 / event.transform.k);
			});

		svg.call(zoom);

		// Update the simulation tick function to ensure proper positioning
		simulation.on("tick", () => {
			link.select("line")
				.attr("x1", d => d.source.x)
				.attr("y1", d => d.source.y)
				.attr("x2", d => d.target.x)
				.attr("y2", d => d.target.y);

			const labels = link.select("text")
				.attr("x", d => (d.source.x + d.target.x) / 2)
				.attr("y", d => (d.source.y + d.target.y) / 2);
			
			link.select("rect")
				.each(function(d) {
					const textBox = link.select("text").node().getBBox();
					d3.select(this)
						.attr("x", (d.source.x + d.target.x) / 2 - textBox.width / 2 - 5)
						.attr("y", (d.source.y + d.target.y) / 2 - textBox.height / 2 - 2)
						.attr("width", textBox.width + 10)
						.attr("height", textBox.height + 4);
				});

			node.attr("transform", d => `translate(${d.x},${d.y})`);
		});

		function dragstarted(event, d) {
			if (!event.active) simulation.alphaTarget(0.3).restart();
			d.fx = d.x;
			d.fy = d.y;
		}

		function dragged(event, d) {
			d.fx = event.x;
			d.fy = event.y;
		}

		function dragended(event, d) {
			if (!event.active) simulation.alphaTarget(0);
			d.fx = null;
			d.fy = null;
		}

		function getRelationshipType(type) {
			switch(type) {
				case 'Department': return 'has department';
				case 'Role': return 'has role';
				case 'Process': return 'has process';
				case 'Task': return 'has task';
				case 'Integration': return 'integrates';
				case 'DataSource': return 'uses';
				case 'AIComponent': return 'implements';
				case 'Analytics': return 'analyzes';
				case 'SoftwareTool': return 'uses tool';
				default: return 'connects to';
			}
		}

		// Add zoom controls
		d3.select("#zoom-in").on("click", () => {
			svg.transition()
				.duration(750)
				.call(zoom.scaleBy, 1.3);
		});

		d3.select("#zoom-out").on("click", () => {
			svg.transition()
				.duration(750)
				.call(zoom.scaleBy, 0.7);
		});

		// Add click handlers to legend items
		d3.selectAll(".legend div")
			.on("click", function() {
				const selectedType = this.textContent.trim();
				const isActive = d3.select(this).classed("active");

				// Reset all legend items
				d3.selectAll(".legend div").classed("active", false);
				
				if (!isActive) {
					// Highlight selected type
					d3.select(this).classed("active", true);
					
					// Dim all nodes except the selected type
					node.classed("dimmed", d => d.type !== selectedType);
					
					// Dim links and their labels based on connection to selected type
					link.classed("dimmed", d => {
						const sourceIsSelected = d.source.type === selectedType;
						const targetIsSelected = d.target.type === selectedType;
						
						// If either node is of the selected type, keep the link and its label visible
						if (sourceIsSelected || targetIsSelected) {
							// Keep link visible
							d3.select(this).select("line").style("opacity", 1);
							// Keep label and background visible
							d3.select(this).select("text").style("opacity", 1);
							d3.select(this).select("rect").style("opacity", 0.8);
							return false;
						} else {
							// Dim everything
							d3.select(this).select("line").style("opacity", 0.1);
							d3.select(this).select("text").style("opacity", 0.1);
							d3.select(this).select("rect").style("opacity", 0.1);
							return true;
						}
					});
				} else {
					// Reset all nodes and links to full opacity
					node.classed("dimmed", false);
					link.classed("dimmed", false);
					// Reset all link components to their original opacity
					link.select("line").style("opacity", 1);
					link.select("text").style("opacity", 1);
					link.select("rect").style("opacity", 0.8);
				}
			});

		// Add double click handler to svg to reset highlighting
		svg.on("dblclick", function() {
			d3.selectAll(".legend div").classed("active", false);
			node.classed("dimmed", false);
			link.classed("dimmed", false);
		});
	</script>
</body>

</html>